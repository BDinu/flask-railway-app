<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login - Weather App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2 class="mb-4">Autentificare</h2>
    <form id="loginForm">
        <div class="mb-3">
            <label for="username" class="form-label">Nume utilizator</label>
            <input type="text" id="username" class="form-control" required />
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">Parolă</label>
            <input type="password" id="password" class="form-control" required />
        </div>
        <button type="submit" class="btn btn-primary">Login</button>
    </form>
    <hr />
    <p>Nu ai cont? <a href="#" id="showSignup">Înregistrează-te aici</a></p>

    <form id="signupForm" style="display:none;">
        <div class="mb-3">
            <label for="su_username" class="form-label">Nume utilizator</label>
            <input type="text" id="su_username" class="form-control" required />
        </div>
        <div class="mb-3">
            <label for="su_password" class="form-label">Parolă</label>
            <input type="password" id="su_password" class="form-control" required />
        </div>
        <button type="submit" class="btn btn-success">Înregistrează-te</button>
        <button type="button" id="cancelSignup" class="btn btn-secondary">Anulează</button>
    </form>

    <div id="message" class="mt-3"></div>
</div>

<script>
    const loginForm = document.getElementById('loginForm');
    const signupForm = document.getElementById('signupForm');
    const showSignup = document.getElementById('showSignup');
    const cancelSignup = document.getElementById('cancelSignup');
    const message = document.getElementById('message');

    showSignup.addEventListener('click', e => {
        e.preventDefault();
        loginForm.style.display = 'none';
        signupForm.style.display = 'block';
        message.textContent = '';
    });

    cancelSignup.addEventListener('click', () => {
        signupForm.style.display = 'none';
        loginForm.style.display = 'block';
        message.textContent = '';
    });

    loginForm.addEventListener('submit', async e => {
        e.preventDefault();
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();
        const res = await fetch('/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({username, password})
        });
        const data = await res.json();
        if(res.ok) {
            window.location.href = '/dashboard';
        } else {
            message.textContent = data.error || 'Eroare autentificare';
            message.style.color = 'red';
        }
    });

    signupForm.addEventListener('submit', async e => {
        e.preventDefault();
        const username = document.getElementById('su_username').value.trim();
        const password = document.getElementById('su_password').value.trim();
        const res = await fetch('/signup', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({username, password})
        });
        const data = await res.json();
        if(res.ok) {
            message.textContent = 'Cont creat! Te poți autentifica acum.';
            message.style.color = 'green';
            signupForm.style.display = 'none';
            loginForm.style.display = 'block';
        } else {
            message.textContent = data.error || 'Eroare înregistrare';
            message.style.color = 'red';
        }
    });
</script>
</body>
</html>
